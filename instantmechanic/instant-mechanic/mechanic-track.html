<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Mechanic - Operations Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-info {
            display: flex;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .info-box {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .info-box label {
            font-size: 12px;
            opacity: 0.8;
            display: block;
            margin-bottom: 5px;
        }

        .info-box .value {
            font-size: 24px;
            font-weight: bold;
        }

        .date-picker {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .date-picker input {
            padding: 10px 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
        }

        .date-picker input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .date-picker button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .date-picker button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
        }

        .tab:hover {
            background: #e8e8e8;
        }

        .tab.active {
            background: white;
            color: #2a5298;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #2a5298;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .filter-btn:hover {
            border-color: #2a5298;
            color: #2a5298;
        }

        .filter-btn.active {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #2a5298;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 25px;
        }

        .customer-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .customer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .customer-card.alert-red {
            border-color: #f44336;
            background: linear-gradient(to right, #fff5f5, white);
        }

        .customer-card.alert-yellow {
            border-color: #ff9800;
            background: linear-gradient(to right, #fff9f0, white);
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            position: relative;
        }

        .card-header.with-booking {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .alert-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .alert-badge.red {
            background: #f44336;
        }

        .alert-badge.yellow {
            background: #ff9800;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .customer-info {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .customer-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .customer-mobile {
            font-size: 14px;
            opacity: 0.9;
        }

        .location-link {
            color: white;
            text-decoration: none;
            font-size: 13px;
            opacity: 0.9;
            display: inline-block;
            margin-top: 5px;
        }

        .location-link:hover {
            opacity: 1;
            text-decoration: underline;
        }

        .card-body {
            padding: 20px;
        }

        .booking-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .booking-id {
            font-weight: bold;
            color: #2a5298;
        }

        .booking-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #4CAF50;
            color: white;
        }

        .status-cancelled {
            background: #f44336;
            color: white;
        }

        .booking-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .detail-item {
            font-size: 13px;
        }

        .detail-label {
            color: #666;
            margin-bottom: 3px;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
        }

        .car-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 10px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .car-image:hover {
            transform: scale(1.05);
        }

        .no-image-badge {
            background: #ff9800;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }

        .events-section {
            margin-top: 15px;
        }

        .events-header {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-time {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #4CAF50;
        }

        .event-item.exit {
            border-left-color: #f44336;
        }

        .event-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
        }

        .event-icon.enter {
            background: #4CAF50;
        }

        .event-icon.exit {
            background: #f44336;
        }

        .event-details {
            flex: 1;
        }

        .event-mechanic {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .event-time {
            font-size: 12px;
            color: #666;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .metric-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-label {
            font-size: 11px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 20px;
            font-weight: bold;
        }

        .booking-actions {
            margin-top: 15px;
        }

        .action-item {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #4CAF50;
        }

        .action-header {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            margin-bottom: 5px;
        }

        .action-type {
            font-weight: bold;
            color: #2e7d32;
            text-transform: capitalize;
        }

        .action-time {
            color: #666;
            font-size: 12px;
        }

        .action-mechanic {
            font-size: 12px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 24px;
            }

            .info-box .value {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>üîß</span> Instant Mechanic - Operations Dashboard
            </h1>
            <div class="date-picker">
                <label style="opacity: 0.9;">Select Date:</label>
                <input type="date" id="dateInput" value="">
                <button onclick="loadData()">Load Data</button>
                <button onclick="loadData()" style="background: #2196F3;">Refresh</button>
            </div>
            <div class="header-info">
                <div class="info-box">
                    <label>Total Customers</label>
                    <div class="value" id="totalCustomers">0</div>
                </div>
                <div class="info-box">
                    <label>Total Events</label>
                    <div class="value" id="totalEvents">0</div>
                </div>
                <div class="info-box">
                    <label>With Bookings</label>
                    <div class="value" id="withBookings">0</div>
                </div>
                <div class="info-box">
                    <label>Red Alerts</label>
                    <div class="value" id="redAlerts" style="color: #f44336;">0</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('all')">
                All Visits (<span id="allCount">0</span>)
            </div>
            <div class="tab" onclick="switchTab('with-booking')">
                With Booking (<span id="withBookingCount">0</span>)
            </div>
            <div class="tab" onclick="switchTab('without-booking')">
                Without Booking (<span id="withoutBookingCount">0</span>)
            </div>
            <div class="tab" onclick="switchTab('alerts')">
                üö® Alerts (<span id="alertsCount">0</span>)
            </div>
        </div>

        <div class="tab-content active" id="allTab">
            <div class="filters">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search by customer name, mobile, or mechanic..." onkeyup="filterCards()">
                </div>
                <button class="filter-btn active" onclick="filterByStatus('all')">All</button>
                <button class="filter-btn" onclick="filterByStatus('completed')">Completed</button>
                <button class="filter-btn" onclick="filterByStatus('cancelled')">Cancelled</button>
                <button class="filter-btn" onclick="filterByStatus('active')">Active</button>
            </div>
            <div class="cards-grid" id="allCards"></div>
        </div>

        <div class="tab-content" id="with-bookingTab">
            <div class="filters">
                <div class="search-box">
                    <input type="text" placeholder="Search..." onkeyup="filterCards()">
                </div>
            </div>
            <div class="cards-grid" id="withBookingCards"></div>
        </div>

        <div class="tab-content" id="without-bookingTab">
            <div class="filters">
                <div class="search-box">
                    <input type="text" placeholder="Search..." onkeyup="filterCards()">
                </div>
            </div>
            <div class="cards-grid" id="withoutBookingCards"></div>
        </div>

        <div class="tab-content" id="alertsTab">
            <div class="cards-grid" id="alertsCards"></div>
        </div>
    </div>

    <div class="modal" id="imageModal" onclick="closeModal()">
        <div class="modal-content">
            <img id="modalImage" src="" alt="Car Image">
        </div>
    </div>

    <script>
        let trackingData = [];
        let currentTab = 'all';
        let currentFilter = 'all';

        // Set today's date as default
        document.getElementById('dateInput').valueAsDate = new Date();

        // Load data on page load
        window.onload = () => {
            loadData();
        };

        async function loadData() {
            const date = document.getElementById('dateInput').value;
            const allCardsDiv = document.getElementById('allCards');
            allCardsDiv.innerHTML = '<div class="loading">Loading data...</div>';

            try {
                const response = await fetch(`https://ai.instantmechanic.online/bot/track-mechanic?date=${date}`, {
                    headers: {
                        'Accept': '*/*',
                        'Origin': 'https://instantmechanic.online',
                        'Referer': 'https://instantmechanic.online/'
                    }
                });

                const data = await response.json();
                trackingData = data.tracking_data || [];

                // Update header stats
                document.getElementById('totalCustomers').textContent = data.total_customers || 0;
                document.getElementById('totalEvents').textContent = data.total_events || 0;

                // Calculate stats
                const withBookings = trackingData.filter(c => c.bookings && c.bookings.length > 0).length;
                const alerts = trackingData.filter(c => hasAlert(c)).length;

                document.getElementById('withBookings').textContent = withBookings;
                document.getElementById('redAlerts').textContent = alerts;

                // Update tab counts
                document.getElementById('allCount').textContent = trackingData.length;
                document.getElementById('withBookingCount').textContent = withBookings;
                document.getElementById('withoutBookingCount').textContent = trackingData.length - withBookings;
                document.getElementById('alertsCount').textContent = alerts;

                // Render cards
                renderCards();
            } catch (error) {
                console.error('Error loading data:', error);
                allCardsDiv.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùå</div><h3>Error loading data</h3><p>Please try again later</p></div>';
            }
        }

        function hasAlert(customer) {
            if (!customer.events || customer.events.length === 0) return false;

            // Check if cancelled booking but mechanic reached
            const hasCancelledBooking = customer.bookings && customer.bookings.some(b => b.is_cancelled);
            if (hasCancelledBooking) return true;

            // Check if no booking but mechanic reached
            const hasNoBooking = !customer.bookings || customer.bookings.length === 0;
            if (hasNoBooking) return true;

            return false;
        }

        function getAlertType(customer) {
            if (!customer.events || customer.events.length === 0) return null;

            const hasCancelledBooking = customer.bookings && customer.bookings.some(b => b.is_cancelled);
            const hasNoBooking = !customer.bookings || customer.bookings.length === 0;

            if (hasCancelledBooking) return 'red';
            if (hasNoBooking) return 'red';

            return null;
        }

        function getAlertMessage(customer) {
            const hasCancelledBooking = customer.bookings && customer.bookings.some(b => b.is_cancelled);
            const hasNoBooking = !customer.bookings || customer.bookings.length === 0;

            if (hasCancelledBooking) return '‚ö†Ô∏è Cancelled Booking';
            if (hasNoBooking) return '‚ö†Ô∏è No Booking';

            return '';
        }

        function calculateTimeInGeofence(events) {
            let totalMinutes = 0;
            let enterTime = null;

            events.forEach(event => {
                if (event.event_type === 'geofenceEnter') {
                    enterTime = new Date(event.created_at);
                } else if (event.event_type === 'geofenceExit' && enterTime) {
                    const exitTime = new Date(event.created_at);
                    const diffMinutes = Math.round((exitTime - enterTime) / (1000 * 60));
                    totalMinutes += diffMinutes;
                    enterTime = null;
                }
            });

            return totalMinutes;
        }

        function calculateResponseTime(events, bookings) {
            if (!bookings || bookings.length === 0) return null;

            const firstEnter = events.find(e => e.event_type === 'geofenceEnter');
            if (!firstEnter) return null;

            const acceptAction = bookings[0].booking_actions.find(a => a.action === 'accept');
            if (!acceptAction) return null;

            const enterTime = new Date(firstEnter.created_at);
            const acceptTime = new Date(acceptAction.created_at);
            const diffMinutes = Math.round((acceptTime - enterTime) / (1000 * 60));

            return diffMinutes;
        }

        function renderCards() {
            const allCards = document.getElementById('allCards');
            const withBookingCards = document.getElementById('withBookingCards');
            const withoutBookingCards = document.getElementById('withoutBookingCards');
            const alertsCards = document.getElementById('alertsCards');

            allCards.innerHTML = '';
            withBookingCards.innerHTML = '';
            withoutBookingCards.innerHTML = '';
            alertsCards.innerHTML = '';

            if (trackingData.length === 0) {
                allCards.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>No data available</h3><p>Try selecting a different date</p></div>';
                return;
            }

            trackingData.forEach(customer => {
                const card = createCustomerCard(customer);

                // Add to all tab
                allCards.appendChild(card.cloneNode(true));

                // Add to appropriate tab
                if (customer.bookings && customer.bookings.length > 0) {
                    withBookingCards.appendChild(card.cloneNode(true));
                } else {
                    withoutBookingCards.appendChild(card.cloneNode(true));
                }

                // Add to alerts tab if has alert
                if (hasAlert(customer)) {
                    alertsCards.appendChild(card.cloneNode(true));
                }
            });

            // Re-attach event listeners
            attachEventListeners();
        }

        function createCustomerCard(customer) {
            const card = document.createElement('div');
            card.className = 'customer-card';

            const alertType = getAlertType(customer);
            if (alertType) {
                card.classList.add(`alert-${alertType}`);
            }

            const hasBooking = customer.bookings && customer.bookings.length > 0;
            const timeInGeofence = calculateTimeInGeofence(customer.events);
            const responseTime = calculateResponseTime(customer.events, customer.bookings);

            let alertBadgeHTML = '';
            if (alertType) {
                alertBadgeHTML = `<div class="alert-badge ${alertType}">${getAlertMessage(customer)}</div>`;
            }

            card.innerHTML = `
                <div class="card-header ${hasBooking ? 'with-booking' : ''}">
                    ${alertBadgeHTML}
                    <div class="customer-info">
                        <div>
                            <div class="customer-name">${customer.customer_name}</div>
                            <div class="customer-mobile">üì± ${customer.customer_mobile}</div>
                            ${customer.location_url ? `<a href="${customer.location_url}" target="_blank" class="location-link">üìç View Location</a>` : ''}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    ${hasBooking ? renderBookingInfo(customer.bookings[0]) : '<div style="text-align: center; padding: 20px; color: #999;">No booking for this visit</div>'}
                    
                    <div class="events-section">
                        <div class="events-header">
                            <span>Mechanic Visits (${customer.events.length})</span>
                            <span class="total-time">‚è±Ô∏è ${timeInGeofence} mins total</span>
                        </div>
                        ${renderEvents(customer.events)}
                    </div>

                    <div class="metrics">
                        <div class="metric-box">
                            <div class="metric-label">Time in Geofence</div>
                            <div class="metric-value">${timeInGeofence}m</div>
                        </div>
                        ${responseTime !== null ? `
                        <div class="metric-box">
                            <div class="metric-label">Response Time</div>
                            <div class="metric-value">${responseTime}m</div>
                        </div>
                        ` : ''}
                        <div class="metric-box">
                            <div class="metric-label">Total Visits</div>
                            <div class="metric-value">${customer.events.length}</div>
                        </div>
                    </div>

                    ${hasBooking && customer.bookings[0].booking_actions.length > 0 ? renderBookingActions(customer.bookings[0].booking_actions) : ''}
                </div>
            `;

            return card;
        }

        function renderBookingInfo(booking) {
            const hasImage = booking.user_car_image && booking.user_car_image !== null;
            const imageHTML = hasImage 
                ? `<img src="${booking.user_car_image}" class="car-image" onclick="openModal('${booking.user_car_image}')" alt="Car Image">`
                : '<div class="no-image-badge">üì∑ No Image Uploaded</div>';

            return `
                <div class="booking-info">
                    <div class="booking-header">
                        <span class="booking-id">Booking #${booking.booking_id}</span>
                        <span class="booking-status ${booking.is_cancelled ? 'status-cancelled' : 'status-active'}">
                            ${booking.is_cancelled ? 'CANCELLED' : 'ACTIVE'}
                        </span>
                    </div>
                    <div class="booking-details">
                        <div class="detail-item">
                            <div class="detail-label">Car</div>
                            <div class="detail-value">${booking.car || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Problem</div>
                            <div class="detail-value">${booking.problem || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Price</div>
                            <div class="detail-value">${booking.price || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Created At</div>
                            <div class="detail-value">${formatTime(booking.created_at)}</div>
                        </div>
                    </div>
                    ${imageHTML}
                </div>
            `;
        }

        function renderEvents(events) {
            return events.map(event => {
                const isEnter = event.event_type === 'geofenceEnter';
                return `
                    <div class="event-item ${isEnter ? 'enter' : 'exit'}">
                        <div class="event-icon ${isEnter ? 'enter' : 'exit'}">
                            ${isEnter ? 'IN' : 'OUT'}
                        </div>
                        <div class="event-details">
                            <div class="event-mechanic">${event.mechanic_name || 'Unknown'} (${event.mechanic_device_id || 'N/A'})</div>
                            <div class="event-time">${formatTime(event.created_at)}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderBookingActions(actions) {
            return `
                <div class="booking-actions">
                    <div style="font-weight: bold; margin-bottom: 10px;">Booking Actions</div>
                    ${actions.map(action => `
                        <div class="action-item">
                            <div class="action-header">
                                <span class="action-type">${action.action}</span>
                                <span class="action-time">${formatTime(action.created_at)}</span>
                            </div>
                            <div class="action-mechanic">üë§ ${action.mechanic_name}</div>
                            ${action.remarks ? `<div style="font-size: 12px; color: #666; margin-top: 5px;">üí¨ ${action.remarks}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-IN', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
                day: '2-digit',
                month: 'short'
            });
        }

        function switchTab(tab) {
            currentTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function filterByStatus(status) {
            currentFilter = status;

            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter cards
            const allCards = document.querySelectorAll('#allCards .customer-card');
            allCards.forEach(card => {
                const cardHTML = card.innerHTML;
                
                if (status === 'all') {
                    card.style.display = 'block';
                } else if (status === 'completed') {
                    card.style.display = cardHTML.includes('complete') ? 'block' : 'none';
                } else if (status === 'cancelled') {
                    card.style.display = cardHTML.includes('CANCELLED') ? 'block' : 'none';
                } else if (status === 'active') {
                    card.style.display = cardHTML.includes('ACTIVE') && !cardHTML.includes('complete') ? 'block' : 'none';
                }
            });
        }

        function filterCards() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const allCards = document.querySelectorAll('.customer-card');

            allCards.forEach(card => {
                const cardText = card.textContent.toLowerCase();
                if (cardText.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function attachEventListeners() {
            // Attach click listeners to images
            document.querySelectorAll('.car-image').forEach(img => {
                img.addEventListener('click', function() {
                    openModal(this.src);
                });
            });
        }

        function openModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.classList.add('active');
            modalImg.src = imageSrc;
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Prevent modal from closing when clicking on image
        document.getElementById('modalImage').addEventListener('click', function(e) {
            e.stopPropagation();
        });
    </script>
</body>
</html>
