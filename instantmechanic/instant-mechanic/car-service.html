<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Mechanic - Premium Car Service</title>
    <link rel="icon" href="assets/img/favicon.png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Mixpanel -->
    <script type="text/javascript">
    (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
    for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
    mixpanel.init("afeb927e0d7ee7ddfa033985ab2fe603", {debug: true, track_pageview: true, persistence: 'localStorage'});
    </script>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #f59e0b;
            --accent-color: #10b981;
            --dark-color: #0f172a;
            --light-color: #f8fafc;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: var(--gray-50);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--white);
            box-shadow: var(--shadow-md);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .header-top {
            background: var(--dark-color);
            color: var(--white);
            padding: 8px 0;
            font-size: 14px;
        }

        .header-top .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-info {
            display: flex;
            gap: 20px;
        }

        .header-info span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-social {
            display: flex;
            gap: 15px;
        }

        .header-social a {
            color: var(--white);
            transition: color 0.3s ease;
        }

        .header-social a:hover {
            color: var(--secondary-color);
        }

        .header-main {
            padding: 12px 0;
        }

        .header-main .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            font-family: 'Poppins', sans-serif;
        }

        .nav {
            display: flex;
            gap: 25px;
            list-style: none;
        }

        .nav a {
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
        }

        .nav a:hover {
            color: var(--primary-color);
        }

        .nav a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        .nav a:hover::after {
            width: 100%;
        }

        .cta-button {
            background: var(--gradient-primary);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            font-size: 14px;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Main Content */
        .main-content {
            margin-top: 110px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
        }

        .progress-bar {
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gray-200);
            z-index: 1;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: width 0.5s ease;
            z-index: 2;
        }

        .step {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--white);
            border: 2px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--gray-400);
            position: relative;
            z-index: 3;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .step.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--white);
            transform: scale(1.1);
        }

        .step.completed {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--white);
        }

        .section-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-title h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
            font-family: 'Poppins', sans-serif;
        }

        .section-title p {
            font-size: 0.95rem;
            color: var(--gray-600);
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Content Containers */
        .content-container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Grid Container - Mobile First */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        /* Brand Cards */
        .brand-card {
            background: var(--white);
            border-radius: 15px;
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .brand-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-accent);
            opacity: 0.1;
            transition: left 0.5s ease;
        }

        .brand-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .brand-card:hover::before {
            left: 0;
        }

        .brand-card img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .brand-card:hover img {
            transform: scale(1.05);
        }

        .brand-card h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 5px;
        }

        /* Car Cards */
        .car-card {
            background: var(--white);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            border: 2px solid transparent;
        }

        .car-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .car-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .car-card-content {
            padding: 15px 10px;
            text-align: center;
        }

        .car-card h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-800);
            line-height: 1.3;
        }

        /* Selected Car Display */
        .selected-car {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--primary-color);
        }

        .selected-car img {
            width: 100%;
            max-width: 280px;
            height: 180px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .selected-car h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        /* Back Button */
        .back-btn {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .back-btn:hover {
            background: var(--primary-color);
            color: var(--white);
            transform: translateY(-1px);
        }

        /* Service Cards */
        .service-card {
            background: var(--white);
            border-radius: 18px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .service-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .service-header {
            background: var(--gradient-primary);
            color: var(--white);
            padding: 18px;
            position: relative;
        }

        .service-tag {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--secondary-color);
            color: var(--white);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .service-header h3 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .service-content {
            padding: 20px;
        }

        .service-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .price-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        .original-price {
            font-size: 1rem;
            text-decoration: line-through;
            color: var(--gray-400);
        }

        .discounted-price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .discount-badge {
            background: var(--accent-color);
            color: var(--white);
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Coupon Section */
        .coupon-section {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px dashed var(--primary-color);
            border-radius: 15px;
            padding: 18px;
            margin: 18px 0;
            transition: all 0.3s ease;
        }

        .coupon-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .coupon-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .coupon-toggle {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 4px;
            transition: transform 0.3s ease;
        }

        .coupon-toggle.expanded {
            transform: rotate(180deg);
        }

        .coupon-input-section {
            display: none;
            animation: slideDown 0.3s ease;
        }

        .coupon-input-section.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .coupon-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .coupon-input {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .coupon-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .coupon-input.success {
            border-color: var(--accent-color);
            background: #f0fdf4;
        }

        .coupon-input.error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .apply-coupon-btn {
            background: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 60px;
        }

        .apply-coupon-btn:hover {
            background: #1d4ed8;
        }

        .apply-coupon-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .coupon-message {
            font-size: 0.85rem;
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .coupon-message.success {
            color: var(--accent-color);
        }

        .coupon-message.error {
            color: #ef4444;
        }

        .coupon-savings {
            background: var(--accent-color);
            color: var(--white);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            margin-top: 8px;
        }

        /* Final Price Section */
        .final-price-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--secondary-color);
        }

        .price-breakdown {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .price-row.total {
            border-top: 2px solid var(--secondary-color);
            padding-top: 8px;
            margin-top: 8px;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--dark-color);
        }

        .price-row .discount {
            color: var(--accent-color);
            font-weight: 600;
        }

        .service-details {
            margin-bottom: 18px;
        }

        .service-details h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 12px;
        }

        .inclusions-list {
            list-style: none;
            margin-bottom: 12px;
        }

        .inclusions-list li {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 0.9rem;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .inclusions-list li i {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .see-more-btn {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 6px 14px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            font-size: 0.85rem;
        }

        .see-more-btn:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .service-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 12px;
        }

        .info-item {
            text-align: center;
            flex: 1;
        }

        .info-item i {
            color: var(--primary-color);
            font-size: 1rem;
            margin-bottom: 4px;
            display: block;
        }

        .info-item .label {
            font-size: 0.75rem;
            color: var(--gray-500);
            display: block;
            margin-bottom: 2px;
        }

        .info-item .value {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.8rem;
        }

        .book-service-btn {
            background: var(--gradient-secondary);
            color: var(--white);
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .book-service-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--white);
            border-radius: 25px;
            padding: 35px 30px;
            max-width: 420px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.7) translateY(50px);
            transition: all 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: var(--white);
            font-size: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
            font-family: 'Poppins', sans-serif;
        }

        .modal-subtitle {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--gray-50);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-input.error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .error-message {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: var(--white);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 2;
            position: relative;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Success Page Styles */
        .success-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--white);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .success-page.show {
            opacity: 1;
            visibility: visible;
        }

        .success-content {
            text-align: center;
            max-width: 500px;
            padding: 40px 30px;
        }

        .success-animation {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            background: var(--gradient-success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: successPulse 2s infinite;
        }

        .success-animation i {
            color: var(--white);
            font-size: 3rem;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .success-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 15px;
            font-family: 'Poppins', sans-serif;
        }

        .success-subtitle {
            font-size: 1.1rem;
            color: var(--gray-600);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .success-details {
            background: var(--gray-50);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: left;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: var(--gray-700);
        }

        .detail-value {
            color: var(--gray-900);
            font-weight: 500;
        }

        .success-actions {
            display: flex;
            gap: 15px;
            flex-direction: column;
        }

        .btn-whatsapp {
            background: #25d366;
            color: var(--white);
            padding: 15px 25px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .btn-whatsapp:hover {
            background: #128c7e;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-home {
            background: var(--gradient-primary);
            color: var(--white);
            padding: 12px 25px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-home:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Specific Adjustments */
        @media (max-width: 768px) {
            .header-top {
                display: none;
            }

            .header-main {
                padding: 10px 0;
            }

            .header-main .container {
                padding: 0 12px;
            }

            .logo {
                font-size: 20px;
            }

            .nav {
                display: none;
            }

            .cta-button {
                padding: 8px 16px;
                font-size: 13px;
            }

            .main-content {
                margin-top: 70px;
                padding: 15px 10px;
            }

            .section-title h1 {
                font-size: 1.5rem;
            }

            .section-title p {
                font-size: 0.9rem;
            }

            .progress-bar {
                max-width: 100%;
                margin-bottom: 25px;
            }

            .step {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }

            .grid-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .brand-card {
                padding: 15px 8px;
                border-radius: 12px;
            }

            .brand-card img {
                width: 40px;
                height: 40px;
                margin-bottom: 8px;
            }

            .brand-card h3 {
                font-size: 0.8rem;
                line-height: 1.2;
            }

            .car-card img {
                height: 90px;
                padding: 6px;
                background: var(--gray-50);
            }

            .car-card-content {
                padding: 12px 8px;
            }

            .car-card h3 {
                font-size: 0.8rem;
            }

            .selected-car {
                padding: 15px;
                margin-bottom: 20px;
            }

            .selected-car img {
                height: 100px;
                max-width: 160px;
                padding: 6px;
            }

            .selected-car h2 {
                font-size: 1.1rem;
            }

            .service-card {
                margin-bottom: 15px;
                border-radius: 15px;
            }

            .service-header {
                padding: 15px;
            }

            .service-header h3 {
                font-size: 1.1rem;
            }

            .service-tag {
                font-size: 0.7rem;
                padding: 3px 8px;
            }

            .service-content {
                padding: 15px;
            }

            .service-image {
                height: 140px;
            }

            .price-section {
                gap: 8px;
            }

            .original-price {
                font-size: 0.9rem;
            }

            .discounted-price {
                font-size: 1.3rem;
            }

            .coupon-section {
                padding: 15px;
                margin: 15px 0;
            }

            .coupon-input-group {
                flex-direction: column;
                gap: 10px;
            }

            .apply-coupon-btn {
                width: 100%;
                padding: 12px 16px;
            }

            .final-price-section {
                padding: 12px;
                margin: 12px 0;
            }

            .service-info {
                gap: 8px;
                padding: 10px;
            }

            .info-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                text-align: left;
            }

            .info-item i {
                margin-bottom: 0;
                margin-right: 8px;
            }

            .book-service-btn {
                font-size: 0.95rem;
                padding: 11px 20px;
            }

            .modal {
                padding: 25px 20px;
                width: 95%;
            }

            .modal-title {
                font-size: 1.3rem;
            }

            .success-content {
                padding: 30px 20px;
            }

            .success-title {
                font-size: 1.6rem;
            }

            .success-actions {
                gap: 12px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn-secondary, .btn-primary {
                flex: none;
            }

            .back-btn {
                font-size: 0.85rem;
                padding: 8px 14px;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .main-content {
                padding: 12px 8px;
            }

            .grid-container {
                gap: 6px;
            }

            .brand-card {
                padding: 12px 6px;
            }

            .brand-card img {
                width: 35px;
                height: 35px;
            }

            .brand-card h3 {
                font-size: 0.75rem;
            }

            .section-title h1 {
                font-size: 1.3rem;
            }

            .success-animation {
                width: 100px;
                height: 100px;
            }

            .success-animation i {
                font-size: 2.5rem;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-left {
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }
    </style>

    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '479182611911558');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=479182611911558&ev=PageView&noscript=1"
    /></noscript>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-info">
                    <span>
                        <i class="fas fa-phone"></i>
                        +91 9266961110
                    </span>
                    <span>
                        <i class="fas fa-map-marker-alt"></i>
                        Sector 75, Gurgaon, Haryana
                    </span>
                </div>
                <div class="header-social">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
        
        <div class="header-main">
            <div class="container">
                <a href="index.html" class="logo">Instant Mechanic</a>
                
                <nav class="nav">
                    <a href="#home">Home</a>
                    <a href="#services">Services</a>
                    <a href="#about">About</a>
                    <a href="#contact">Contact</a>
                </nav>
                
                <a href="tel:+919266961110" class="cta-button">
                    <i class="fas fa-phone"></i> Call Now
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-steps">
                <div class="progress-line" id="progressLine"></div>
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
                <div class="step" id="step3">3</div>
                <div class="step" id="step4">4</div>
            </div>
        </div>

        <!-- Dynamic Content -->
        <div class="content-container">
            <!-- Back Button -->
            <button class="back-btn hidden" id="backBtn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                Back
            </button>

            <!-- Section Title -->
            <div class="section-title" id="sectionTitle">
                <h1>Choose Your Car Brand</h1>
                <p>Select your car brand to get started with our premium service experience</p>
            </div>

            <!-- Brand Selection -->
            <div class="grid-container" id="brandContainer"></div>

            <!-- Car Selection -->
            <div class="grid-container hidden" id="carContainer"></div>

            <!-- Selected Car Display -->
            <div class="selected-car hidden" id="selectedCarDisplay"></div>

            <!-- Service Selection -->
            <div class="content-container hidden" id="serviceContainer"></div>

            <!-- Loading State -->
            <div class="loading hidden" id="loadingState">
                <div class="spinner"></div>
                Loading services...
            </div>
        </div>
    </main>

    <!-- Mobile Number Modal -->
    <div class="modal-overlay" id="mobileModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <h2 class="modal-title">Contact Information</h2>
                <p class="modal-subtitle">Please provide your mobile number to complete the booking</p>
            </div>
            
            <form id="mobileForm">
                <div class="form-group">
                    <label class="form-label" for="mobileNumber">Mobile Number</label>
                    <input 
                        type="tel" 
                        id="mobileNumber" 
                        class="form-input" 
                        placeholder="Enter your 10-digit mobile number"
                        maxlength="10"
                        pattern="[0-9]{10}"
                    >
                    <div class="error-message" id="mobileError"></div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="closeMobileModal()">Cancel</button>
                    <button type="submit" class="btn-primary" id="submitMobile">
                        <span class="btn-text">Continue Booking</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Page -->
    <div class="success-page" id="successPage">
        <div class="success-content">
            <div class="success-animation">
                <i class="fas fa-check"></i>
            </div>
            
            <h1 class="success-title">Booking Confirmed!</h1>
            <p class="success-subtitle">
                Thank you for choosing Instant Mechanic! Your service has been successfully booked. 
                Our expert team will contact you shortly to confirm the appointment details.
            </p>
            
            <div class="success-details" id="bookingDetails">
                <!-- Booking details will be populated here -->
            </div>
            
            <div class="success-actions">
                <a href="#" class="btn-whatsapp" id="whatsappLink">
                    <i class="fab fa-whatsapp"></i>
                    Chat on WhatsApp
                </a>
                <a href="/" class="btn-home">
                    <i class="fas fa-home"></i>
                    Back to Home
                </a>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let brands = [];
        let cars = [];
        let currentStep = 1;
        let selectedBrand = null;
        let selectedCar = null;
        let selectedService = null;
        let userMobile = null;
        let appliedCoupon = null;
        let couponDiscount = 0;

        // URL parameter handling for direct access
        function getURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                mobile: extractMobile(urlParams.get('mobile')),
                brand_id: urlParams.get('brand_id'),
                brand_name: urlParams.get('brand_name') || urlParams.get('brand'), // Support both formats
                car_id: urlParams.get('car_id'),
                car_name: urlParams.get('car_name') || urlParams.get('car'), // Support both formats
                car_image: urlParams.get('car_image')
            };
        }

        // Update URL with current selection for easy agent sharing
        function updateURLWithSelection(brandName, carName, carId, brandId, carImage) {
            const url = new URL(window.location);
            
            // Clear all existing parameters first
            url.search = '';
            
            // Add brand_id and car_id for reliable matching
            url.searchParams.set('brand_id', brandId);
            url.searchParams.set('car_id', carId);
            
            // Update browser URL without page reload
            window.history.replaceState({}, '', url);
            
            // Show notification for agents
        }

        // Show notification for agents when URL is updated
        function showAgentNotification(message) {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('agent-notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'agent-notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 600;
                    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
                    z-index: 9999;
                    opacity: 0;
                    transform: translateY(-20px);
                    transition: all 0.3s ease;
                    max-width: 300px;
                    line-height: 1.4;
                `;
                document.body.appendChild(notification);
            }
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-link" style="font-size: 16px;"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Show notification
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 100);
            
            // Hide notification after 4 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
            }, 4000);
        }

        // Extract mobile from URL parameter (handles various formats)
        function extractMobile(mobileParam) {
            if (!mobileParam) return null;
            
            // URL decode the mobile parameter
            let mobile = decodeURIComponent(mobileParam);
            
            // Extract only the mobile number part (remove any extra data after '/')
            if (mobile.includes('/')) {
                mobile = mobile.split('/')[0];
            }
            
            // Remove any non-digit characters and country code prefix
            mobile = mobile.replace(/[^0-9]/g, '');
            
            // Handle Indian mobile numbers - remove country code if present
            if (mobile.startsWith('91') && mobile.length === 12) {
                mobile = mobile.substring(2); // Remove '91' prefix
            }
            
            // Return only if it's a valid 10-digit mobile number
            return mobile.length === 10 ? mobile : null;
        }

        // Initialize Mixpanel tracking
        function initializeTracking() {
            const urlParams = getURLParams();
            
            if (urlParams.mobile && isValidMobile(urlParams.mobile)) {
                userMobile = urlParams.mobile;
                mixpanel.identify(userMobile);
                mixpanel.people.set({
                    "$phone": userMobile,
                    "Last Seen": new Date()
                });
            }

            // Track page view with additional context
            const trackingData = {
                'Source': 'Service Selection Page',
                'Mobile': userMobile,
                'Timestamp': new Date().toISOString()
            };

            // Add direct access parameters if present
            if (urlParams.brand_id || urlParams.car_id) {
                trackingData['Direct Access'] = true;
                trackingData['Brand ID'] = urlParams.brand_id;
                trackingData['Car ID'] = urlParams.car_id;
                trackingData['Brand Name'] = urlParams.brand_name;
                trackingData['Car Name'] = urlParams.car_name;
            }

            mixpanel.track('Service Page Opened', trackingData);
        }

        // Validate mobile number
        function isValidMobile(mobile) {
            const mobileRegex = /^[6-9]\d{9}$/;
            return mobileRegex.test(mobile);
        }

        // Check for direct access and bypass steps if needed
        function checkDirectAccess() {
            const urlParams = getURLParams();
            
            // If we have both brand_id and car_id, find the matching data
            if (urlParams.brand_id && urlParams.car_id) {
                const brandId = parseInt(urlParams.brand_id);
                const carId = urlParams.car_id; // Keep as string since car_type_id can be string
                
                
                // Find matching brand from loaded data by ID
                let matchingBrand = brands.find(b => b.id === brandId);
                
                // Find matching car from loaded data by car_type_id (handle both string and number)
                let matchingCar = cars.find(c => 
                    c.car_type_id === carId || 
                    c.car_type_id === parseInt(carId) || 
                    c.car_type_id.toString() === carId.toString()
                );
                
                // Debug: Show cars for this brand
                if (matchingBrand) {
                    const brandCars = cars.filter(c => c.brand && c.brand.id === brandId);
                }
                
                
                if (matchingBrand && matchingCar) {
                    selectedBrand = matchingBrand;
                    selectedCar = matchingCar;
                    
                    // Store in localStorage for consistency
                    localStorage.setItem('selectedBrand', JSON.stringify(selectedBrand));
                    localStorage.setItem("selectedCarId", selectedCar.car_type_id);
                    localStorage.setItem("selectedCarName", selectedCar.name);
                    localStorage.setItem("carImage", selectedCar.image_path);
                    localStorage.setItem("brand", selectedCar.brand.name);
                    localStorage.setItem("carName", selectedCar.name);

                    // Track direct access
                    mixpanel.track('Direct Service Access', {
                        'Brand': selectedBrand.name,
                        'Car Model': selectedCar.name,
                        'Car ID': selectedCar.car_type_id,
                        'Fuel Type': selectedCar.fuel_type,
                        'Mobile': userMobile,
                        'Access Type': 'Agent Shared Link',
                        'URL Format': 'ID Based',
                        'Timestamp': new Date().toISOString()
                    });

                    // Skip to pricing page
                    skipToPricingPage();
                    return true;
                } else if (matchingBrand && !matchingCar) {
                    // Brand exists but car doesn't - show available cars for this brand
                    selectedBrand = matchingBrand;
                    localStorage.setItem('selectedBrand', JSON.stringify(selectedBrand));
                    
                    // Skip to car selection for this brand
                    skipToCarSelection();
                    return true;
                } else {
                    // If exact match not found, show error or fallback to normal flow
                    showDirectAccessError(`Brand ID: ${brandId}`, `Car ID: ${carId}`);
                    return false;
                }
            }
            
            // If we only have brand_id, find matching brand
            else if (urlParams.brand_id) {
                const brandId = parseInt(urlParams.brand_id);
                
                let matchingBrand = brands.find(b => b.id === brandId);
                
                if (matchingBrand) {
                    selectedBrand = matchingBrand;
                    localStorage.setItem('selectedBrand', JSON.stringify(selectedBrand));
                    
                    // Track partial direct access
                    mixpanel.track('Direct Brand Access', {
                        'Brand': selectedBrand.name,
                        'Brand ID': selectedBrand.id,
                        'Mobile': userMobile,
                        'Access Type': 'Agent Shared Link',
                        'URL Format': 'ID Based',
                        'Timestamp': new Date().toISOString()
                    });

                    // Skip to car selection
                    skipToCarSelection();
                    return true;
                } else {
                    console.log('Brand not found by ID:', brandId);
                }
            }
            
            // Fallback: check for legacy text-based parameters
            else if (urlParams.brand && urlParams.car) {
                // Clean and normalize the URL parameters
                const brandName = decodeURIComponent(urlParams.brand).trim();
                const carName = decodeURIComponent(urlParams.car).trim();
                
                
                // Find matching brand from loaded data (case insensitive, flexible matching)
                let matchingBrand = brands.find(b => {
                    const dbBrandName = b.name.toLowerCase().trim();
                    const searchBrandName = brandName.toLowerCase().trim();
                    
                    // Direct match or contains match (for brands like "Maruti Suzuki" vs "Maruti")
                    return dbBrandName === searchBrandName || 
                           dbBrandName.includes(searchBrandName) || 
                           searchBrandName.includes(dbBrandName);
                });
                
                // Find matching car from loaded data (case insensitive, flexible matching)
                let matchingCar = null;
                if (matchingBrand) {
                    matchingCar = cars.find(c => {
                        const dbCarName = c.name.toLowerCase().trim();
                        const searchCarName = carName.toLowerCase().trim();
                        const sameBrand = c.brand && c.brand.name.toLowerCase().trim() === matchingBrand.name.toLowerCase().trim();
                        
                        return sameBrand && (
                            dbCarName === searchCarName || 
                            dbCarName.includes(searchCarName) || 
                            searchCarName.includes(dbCarName)
                        );
                    });
                }
                
                if (matchingBrand && matchingCar) {
                    selectedBrand = matchingBrand;
                    selectedCar = matchingCar;
                    
                    // Store in localStorage for consistency
                    localStorage.setItem('selectedBrand', JSON.stringify(selectedBrand));
                    localStorage.setItem("selectedCarId", selectedCar.car_type_id);
                    localStorage.setItem("selectedCarName", selectedCar.name);
                    localStorage.setItem("carImage", selectedCar.image_path);
                    localStorage.setItem("brand", selectedCar.brand.name);
                    localStorage.setItem("carName", selectedCar.name);

                    // Update URL to ID-based format for future sharing
                    updateURLWithSelection(selectedBrand.name, selectedCar.name, selectedCar.car_type_id, selectedBrand.id, selectedCar.image_path);

                    // Skip to pricing page
                    skipToPricingPage();
                    return true;
                }
            }
            
            return false;
        }
        
        // Show error when direct access parameters don't match database
        function showDirectAccessError(brandName, carName) {
            updateSectionTitle('Vehicle Not Found', `We couldn't find ${brandName} ${carName} in our database`);
            
            const container = document.getElementById('brandContainer');
            container.innerHTML = `
                <div class="text-center" style="padding: 40px; grid-column: 1 / -1;">
                    <i class="fas fa-search" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 20px;"></i>
                    <h3 style="color: var(--gray-600); margin-bottom: 15px;">Vehicle Not Found</h3>
                    <p style="color: var(--gray-500); margin-bottom: 20px;">
                        We couldn't find "<strong>${brandName} ${carName}</strong>" in our database.<br>
                        Please select your vehicle from the available options below.
                    </p>
                    <button onclick="location.reload()" class="btn-primary" style="padding: 12px 20px; margin-right: 10px;">
                        <i class="fas fa-refresh"></i> Start Over
                    </button>
                    <a href="tel:+919266961110" class="cta-button">
                        <i class="fas fa-phone"></i> Call for Help
                    </a>
                </div>
            `;
            
            // After showing error, load normal brand selection
            setTimeout(() => {
                displayBrands();
            }, 2000);
        }

        // Skip to car selection page
        function skipToCarSelection() {
            updateProgress(2);
            updateSectionTitle('Select Your Car Model', `Choose your ${selectedBrand.name} model`);
            
            // Hide brand container and show loading
            document.getElementById('brandContainer').classList.add('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('loadingState').classList.add('hidden');
                displayCars(selectedBrand.id);
            }, 800);
        }

        // Skip directly to pricing page
        function skipToPricingPage() {
            updateProgress(4);
            updateSectionTitle('Choose Your Service', `Perfect service packages for your ${selectedBrand.name} ${selectedCar.name}`);
            
            // Hide all selection containers
            document.getElementById('brandContainer').classList.add('hidden');
            document.getElementById('carContainer').classList.add('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            
            // Show selected car
            displaySelectedCar(selectedCar);
            
            // Load services directly
            loadServices(selectedCar.car_type_id);
        }

        // Go back functionality
        function goBack() {
            if (currentStep === 4) {
                // From service selection back to car selection
                updateProgress(3);
                updateSectionTitle('Your Selected Vehicle', 'Review your selection and choose a service');
                document.getElementById('serviceContainer').classList.add('hidden');
                document.getElementById('selectedCarDisplay').classList.remove('hidden');
                
                // If we came from direct access, go back to car selection
                const urlParams = getURLParams();
                if (urlParams.brand_id && urlParams.car_id) {
                    skipToCarSelection();
                }
            } else if (currentStep === 3) {
                // From car selection back to brand selection (only if not direct access)
                const urlParams = getURLParams();
                if (!urlParams.brand_id) {
                    updateProgress(2);
                    updateSectionTitle('Select Your Car Model', 'Choose the specific model of your car');
                    document.getElementById('selectedCarDisplay').classList.add('hidden');
                    document.getElementById('carContainer').classList.remove('hidden');
                }
            } else if (currentStep === 2) {
                // From car selection back to brand selection
                updateProgress(1);
                updateSectionTitle('Choose Your Car Brand', 'Select your car brand to get started with our premium service experience');
                document.getElementById('carContainer').classList.add('hidden');
                document.getElementById('brandContainer').classList.remove('hidden');
                document.getElementById('backBtn').classList.add('hidden');
                selectedBrand = null;
                selectedCar = null;
            }
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTracking();
            
            // Load data first, then check for direct access
            Promise.all([loadBrandData(), loadCarData()]).then(() => {

                
                // Now check for direct access after data is loaded
                if (!checkDirectAccess()) {
                    // Normal flow - display brands if no direct access
                    displayBrands();
                }
            }).catch(error => {
                // Fallback to normal flow
                displayBrands();
            });
        });

        // Load brand data
        async function loadBrandData() {
            try {
                const response = await fetch('car_brand.json');
                brands = await response.json();
                return Promise.resolve();
            } catch (error) {
                return Promise.reject(error);
            }
        }

        // Load car data
        async function loadCarData() {
            try {
                const response = await fetch('car.json');
                cars = await response.json();
                return Promise.resolve();
            } catch (error) {
                return Promise.reject(error);
            }
        }

        // Display brands
        function displayBrands() {
            const container = document.getElementById('brandContainer');
            container.innerHTML = '';
            
            brands.forEach((brand, index) => {
                const brandCard = document.createElement('div');
                brandCard.className = 'brand-card fade-in';
                brandCard.style.animationDelay = `${index * 0.1}s`;
                
                brandCard.innerHTML = `
                    <img src="${brand.brand_logo}" alt="${brand.name}" loading="lazy">
                    <h3>${brand.name}</h3>
                `;
                
                brandCard.addEventListener('click', () => selectBrand(brand));
                container.appendChild(brandCard);
            });
        }

        // Select brand
        function selectBrand(brand) {
            selectedBrand = brand;
            localStorage.setItem('selectedBrand', JSON.stringify(brand));
            
            // Track brand selection
            mixpanel.track('Service Page - Brand Selected', {
                'Brand': brand.name,
                'Brand ID': brand.id,
                'Mobile': userMobile,
                'Timestamp': new Date().toISOString()
            });
            
            updateProgress(2);
            updateSectionTitle('Select Your Car Model', `Choose your ${brand.name} model`);
            
            // Hide brand container and show loading, show back button
            document.getElementById('brandContainer').classList.add('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            
            setTimeout(() => {
                document.getElementById('loadingState').classList.add('hidden');
                displayCars(brand.id);
            }, 800);
        }

        // Display cars
        function displayCars(brandId) {
            const container = document.getElementById('carContainer');
            container.innerHTML = '';
            container.classList.remove('hidden');

            if (cars.length === 0) {
                container.innerHTML = '<p class="text-center">No car data available. Please try again.</p>';
                return;
            }

            let filteredCars = cars.filter(car => car.brand && car.brand.id === brandId);
            
            if (filteredCars.length === 0) {
                container.innerHTML = '<p class="text-center">No cars found for this brand.</p>';
                return;
            }
            
            // Remove duplicates
            let uniqueCars = [];
            let seenNames = new Set();
            
            filteredCars.forEach(car => {
                if (!seenNames.has(car.name)) {
                    seenNames.add(car.name);
                    uniqueCars.push(car);
                }
            });

            uniqueCars.forEach((car, index) => {
                const carCard = document.createElement('div');
                carCard.className = 'car-card slide-in-left';
                carCard.style.animationDelay = `${index * 0.1}s`;
                
                carCard.innerHTML = `
                    <img src="${car.image_path || 'assets/img/default-car.jpg'}" alt="${car.name}" loading="lazy" 
                         onerror="this.src='assets/img/logo.svg'">
                    <div class="car-card-content">
                        <h3>${car.name}</h3>
                    </div>
                `;
                
                carCard.addEventListener('click', () => selectCar(car));
                container.appendChild(carCard);
            });
        }

        // Select car
        function selectCar(car) {
            selectedCar = car;
            
            // Store car details
            localStorage.setItem("selectedCarId", car.car_type_id);
            localStorage.setItem("selectedCarName", car.name);
            localStorage.setItem("carImage", car.image_path);
            localStorage.setItem("brand", car.brand.name);
            localStorage.setItem("carName", car.name);
            
            // Update URL with selected brand and car for easy sharing by agents
            updateURLWithSelection(car.brand.name, car.name, car.car_type_id, car.brand.id, car.image_path);
            
            // Track car selection
            mixpanel.track('Service Page - Car Selected', {
                'Brand': car.brand.name,
                'Car Model': car.name,
                'Car ID': car.car_type_id,
                'Mobile': userMobile,
                'Timestamp': new Date().toISOString()
            });
            
            updateProgress(3);
            updateSectionTitle('Your Selected Vehicle', 'Review your selection and choose a service');
            
            // Hide car container
            document.getElementById('carContainer').classList.add('hidden');
            
            // Show selected car
            displaySelectedCar(car);
            
            // Add small delay before showing services
            setTimeout(() => {
                updateProgress(4);
                updateSectionTitle('Choose Your Service', `Perfect service packages for your ${car.brand.name} ${car.name}`);
                loadServices(car.car_type_id);
            }, 1500);
        }

        // Display selected car
        function displaySelectedCar(car) {
            const container = document.getElementById('selectedCarDisplay');
            container.classList.remove('hidden');
            
            const carName = `${car.brand.name} ${car.name}`;
            container.innerHTML = `
                <img src="${car.image_path}" alt="Selected Car" loading="lazy" class="fade-in" 
                     onerror="this.src='assets/img/default-car.jpg'">
                <h2 class="fade-in">${carName}</h2>
            `;
        }

        // Load services
        async function loadServices(carId) {
            document.getElementById('loadingState').classList.remove('hidden');
            
            const apiUrl = `https://gomechanic.app/api/v2/oauth/customer/get-services-details-by-category?car_id=${carId}&city_id=6&category_id=0&user_car_id=null`;
            
            const headers = {
                "Accept": "*/*",
                "Authorization": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJuYmYiOjE3NjQ5MjkwNzkuMCwiaWF0IjoxNzY0OTI5MDc5LjAsInNjb3BlcyI6W10sInN1YiI6IjE3NjQ5MjkwNzk5MiIsImF1ZCI6IjMiLCJqdGkiOiJiNGJjM2NhZjVkMWVhOTlkYzk2YjQzM2NjYzQzMDI0ZTAyM2I0MGM2YjQ5ZjExN2JjMDk5OGY2MWU3ZDI1ZjM2MTU1YWU5ZDIxNjE2ZTc5NSIsImV4cCI6MTc2NzUyMTA3OS4wfQ.syWvrIh8fXaKNWChxTtahaYWisDM4ubyHCq5hu27LJg0M3dcE5wPyDv0r7aIWtNiQrSn9_HvlHE7e31CUymXLjmBPSAKDREix-8qDWjVq4A6ircHgk6uB3qPrcJcBzkiCTf06kIjLYWPV2nlhcAI8ZICdidlZbJ4yJaItHnoWwDhXwn65uMXIdMAvccbje6MCUxSFlSKw4owfeSHjUZMitM-fODJYPCyR2a3GR-hDY-dBLVdrqqdae-mZzSbpyi6JcXiHlvve13mr4ajTWVspnc9R4wpG8gLHdjjXEvGrtPAPoqyY34w29KG3oNqZUe8VkyzDX9ydNgO9hJ4Qk3D_lksRFGIJZZQyHC9XQryZsnhP4318rknrjOKahed8ihH-VQC-CgWPHJ7ymvelrZh16xaTjSQPiB2daldAa3CZhke1frJ-3FgghtTZfqnNKCcberAbRiud7CMNaD1EKxVY3pKr-aNqrHK8_vtgCeq1AnBK0q5BKEfyxsZG5n1khar1AeWnxQdXY0_I_qFueoNtCK7HRWs7wniVuulZJzX-RTi-jEQX5Ft70E1XYhuhV6pZ85YKsceT3TZfYzTNSihNbVsPYhUdIeKEQ2MV0JokbFNLA-QhlfRQNCgvAO6mLBn35S-QOxFNSbHxPD2ekHsBrpcZ6NdyZOVZ-yczUy7duM",
                "Content-Type": "application/json"
            };

            try {
                const response = await fetch(apiUrl, { method: "GET", headers: headers });
                const data = await response.json();
                
                document.getElementById('loadingState').classList.add('hidden');
                
if (data.status && data.data.length > 0) {
    const services = data.data[0].services;
    
    // Filter to only show "Standard Service"
    const standardService = services.find(service => 
        service.name && service.name.toLowerCase().includes('standard')
    );
    
    if (standardService) {
        const extractedServices = [{
            name: standardService.name || "N/A",
            service_tag: standardService.service_tag || "Every 3 Month",
            price: standardService.package_details[0].strikethrough || "N/A",
            discounted_price: standardService.package_details[0].total || "N/A",
            image: getServiceImage(standardService.name),
            description: standardService.desc_details || {},
            inclusion: standardService.desc_details?.inclusion || [],
            time_taken: standardService.desc_details?.time_taken || "N/A",
            warranty: standardService.desc_details?.warranty || "N/A"
        }];

        displayServices(extractedServices);
    } else {
        // If Standard Service not found, show no services message
        displayNoServicesMessage();
    }
} else {
    displayNoServicesMessage();
}
            } catch (error) {
                document.getElementById('loadingState').classList.add('hidden');
                displayErrorMessage();
            }
        }

        // Display no services message
        function displayNoServicesMessage() {
            const container = document.getElementById('serviceContainer');
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="text-center" style="padding: 40px;">
                    <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--gray-400); margin-bottom: 20px;"></i>
                    <h3 style="color: var(--gray-600); margin-bottom: 10px;">No Services Available</h3>
                    <p style="color: var(--gray-500);">We couldn't find services for this vehicle. Please contact us directly.</p>
                    <a href="tel:+919266961110" class="cta-button" style="display: inline-block; margin-top: 20px;">
                        <i class="fas fa-phone"></i> Call Now
                    </a>
                </div>
            `;
        }

        // Display error message
        function displayErrorMessage() {
            const container = document.getElementById('serviceContainer');
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="text-center" style="padding: 40px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--secondary-color); margin-bottom: 20px;"></i>
                    <h3 style="color: var(--gray-600); margin-bottom: 10px;">Unable to Load Services</h3>
                    <p style="color: var(--gray-500);">There was an error loading services. Please try again or contact us.</p>
                    <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                        <button onclick="loadServices(selectedCar.car_type_id)" class="btn-primary" style="padding: 10px 20px;">
                            <i class="fas fa-refresh"></i> Try Again
                        </button>
                        <a href="tel:+919266961110" class="cta-button">
                            <i class="fas fa-phone"></i> Call Now
                        </a>
                    </div>
                </div>
            `;
        }

        // Get service image
        function getServiceImage(serviceName) {
            const imageMap = {
                "Standard Service": "assets/img/standard.jpg",
                "Comprehensive Service": "assets/img/premium.jpg",
                "Basic Service": "assets/img/basic.jpg"
            };
            return imageMap[serviceName] || "assets/img/basic.jpg";
        }

        // Toggle coupon section
        function toggleCouponSection(serviceIndex) {
            const couponInput = document.getElementById(`coupon-input-${serviceIndex}`);
            const couponToggle = document.getElementById(`coupon-toggle-${serviceIndex}`);
            
            if (couponInput.classList.contains('active')) {
                couponInput.classList.remove('active');
                couponToggle.classList.remove('expanded');
            } else {
                couponInput.classList.add('active');
                couponToggle.classList.add('expanded');
            }
        }

        // Apply coupon
        function applyCoupon(serviceIndex, originalPrice) {
            const couponInput = document.getElementById(`coupon-code-${serviceIndex}`);
            const applyBtn = document.getElementById(`apply-btn-${serviceIndex}`);
            const messageDiv = document.getElementById(`coupon-message-${serviceIndex}`);
            const couponCode = couponInput.value.trim().toUpperCase();
            
            // Clear previous states
            couponInput.classList.remove('success', 'error');
            messageDiv.innerHTML = '';
            
            if (!couponCode) {
                showCouponMessage(serviceIndex, 'Please enter a coupon code', 'error');
                couponInput.classList.add('error');
                return;
            }
            
            // Show loading
            applyBtn.disabled = true;
            applyBtn.innerHTML = '<div class="spinner" style="width: 16px; height: 16px; margin: 0;"></div>';
            
            setTimeout(() => {
                if (couponCode === 'INSTANT500') {
                    // Valid coupon
                    appliedCoupon = {
                        code: couponCode,
                        discount: 500,
                        serviceIndex: serviceIndex
                    };
                    couponDiscount = 500;
                    
                    couponInput.classList.add('success');
                    showCouponMessage(serviceIndex, 'Coupon applied successfully! 500 discount added.', 'success');
                    showCouponSavings(serviceIndex, 500);
                    updateFinalPrice(serviceIndex, originalPrice);
                    
                    // Track successful coupon application
                    mixpanel.track('Coupon Applied Successfully', {
                        'Coupon Code': couponCode,
                        'Discount Amount': 500,
                        'Service Index': serviceIndex,
                        'Original Price': originalPrice,
                        'Mobile': userMobile,
                        'Timestamp': new Date().toISOString()
                    });
                    
                    // Disable further coupon attempts for this service
                    applyBtn.style.display = 'none';
                    couponInput.disabled = true;
                    
                } else {
                    // Invalid coupon
                    couponInput.classList.add('error');
                    showCouponMessage(serviceIndex, 'Invalid coupon code. Please try again.', 'error');
                    
                    // Track failed coupon attempt
                    mixpanel.track('Coupon Application Failed', {
                        'Coupon Code': couponCode,
                        'Service Index': serviceIndex,
                        'Mobile': userMobile,
                        'Timestamp': new Date().toISOString()
                    });
                }
                
                // Reset button
                applyBtn.disabled = false;
                applyBtn.innerHTML = 'Apply';
            }, 1000);
        }

        // Show coupon message
        function showCouponMessage(serviceIndex, message, type) {
            const messageDiv = document.getElementById(`coupon-message-${serviceIndex}`);
            const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            messageDiv.innerHTML = `<i class="${icon}"></i> ${message}`;
            messageDiv.className = `coupon-message ${type}`;
        }

        // Show coupon savings
        function showCouponSavings(serviceIndex, savings) {
            const savingsDiv = document.getElementById(`coupon-savings-${serviceIndex}`);
            savingsDiv.innerHTML = ` You saved ${savings} with this coupon!`;
            savingsDiv.style.display = 'block';
        }

        // Update final price
        function updateFinalPrice(serviceIndex, originalPrice) {
            const finalPriceDiv = document.getElementById(`final-price-${serviceIndex}`);
            const basePrice = originalPrice + 300; // Add base 300
            const finalPrice = basePrice - couponDiscount;
            
            finalPriceDiv.innerHTML = `
                <div class="price-breakdown">
                    <div class="price-row">
                        <span>Service Price:</span>
                        <span>${originalPrice}</span>
                    </div>
                    <div class="price-row">
                        <span>Service Charges:</span>
                        <span>300</span>
                    </div>
                    ${couponDiscount > 0 ? `
                    <div class="price-row">
                        <span class="discount">Coupon Discount (${appliedCoupon.code}):</span>
                        <span class="discount">-${couponDiscount}</span>
                    </div>` : ''}
                    <div class="price-row total">
                        <span>Total Amount:</span>
                        <span>${finalPrice}</span>
                    </div>
                </div>
            `;
            finalPriceDiv.style.display = 'block';
        }

        // Display services
        function displayServices(services) {
            const container = document.getElementById('serviceContainer');
            container.classList.remove('hidden');
            container.innerHTML = '';

            services.forEach((service, index) => {
                const serviceCard = document.createElement('div');
                serviceCard.className = 'service-card slide-in-right';
                serviceCard.style.animationDelay = `${index * 0.2}s`;
                
                const inclusions = Array.isArray(service.inclusion) ? service.inclusion : [];
                const visibleInclusions = inclusions.slice(0, 5);
                const hiddenInclusions = inclusions.slice(5);
                
                // Add 300 to the API price as base price
                const basePrice = parseInt(service.discounted_price) + 300;
                const originalPrice = parseInt(service.price);
                const savings = originalPrice - basePrice;
                const discountPercentage = Math.round((savings / originalPrice) * 100);
                
                serviceCard.innerHTML = `
                    <div class="service-header">
                        <h3>${service.name}</h3>
                        <div class="service-tag">${service.service_tag}</div>
                    </div>
                    
                    <div class="service-content">
                        <img src="${service.image}" alt="${service.name}" class="service-image" loading="lazy">
                        
                        <div class="price-section">
                            <span class="original-price">${service.price}</span>
                            <span class="discounted-price">${basePrice}</span>
                            <span class="discount-badge">Save ${discountPercentage}%</span>
                        </div>
                        
                        <!-- Coupon Section -->
                        <div class="coupon-section">
                            <div class="coupon-header">
                                <div class="coupon-title">
                                    <i class="fas fa-ticket-alt"></i>
                                    Have a Coupon Code?
                                </div>
                                <button class="coupon-toggle" id="coupon-toggle-${index}" onclick="toggleCouponSection(${index})">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            
                            <div class="coupon-input-section" id="coupon-input-${index}">
                                <div class="coupon-input-group">
                                    <input 
                                        type="text" 
                                        class="coupon-input" 
                                        id="coupon-code-${index}" 
                                        placeholder="Enter coupon code (e.g. INSTANT500)"
                                        maxlength="15"
                                    >
                                    <button class="apply-coupon-btn" id="apply-btn-${index}" onclick="applyCoupon(${index}, ${parseInt(service.discounted_price)})">
                                        Apply
                                    </button>
                                </div>
                                <div class="coupon-message" id="coupon-message-${index}"></div>
                                <div class="coupon-savings" id="coupon-savings-${index}" style="display: none;"></div>
                            </div>
                        </div>
                        
                        <!-- Final Price Section -->
                        <div class="final-price-section" id="final-price-${index}" style="display: none;">
                            <!-- Price breakdown will be populated here -->
                        </div>
                        
                        <div class="service-details">
                            <h4><i class="fas fa-check-circle"></i> What's Included:</h4>
                            <ul class="inclusions-list">
                                ${visibleInclusions.map(item => `
                                    <li><i class="fas fa-check"></i> ${item}</li>
                                `).join('')}
                                <div class="hidden-inclusions hidden" id="more-${index}">
                                    ${hiddenInclusions.map(item => `
                                        <li><i class="fas fa-check"></i> ${item}</li>
                                    `).join('')}
                                </div>
                            </ul>
                            ${hiddenInclusions.length > 0 ? `
                                <button class="see-more-btn" onclick="toggleInclusions(${index})">
                                    <i class="fas fa-chevron-down"></i> Show More
                                </button>
                            ` : ''}
                        </div>
                        
                        <div class="service-info">
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <div>
                                    <span class="label">Duration</span>
                                    <span class="value">${service.time_taken}</span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-shield-alt"></i>
                                <div>
                                    <span class="label">Warranty</span>
                                    <span class="value">${service.warranty}</span>
                                </div>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-star"></i>
                                <div>
                                    <span class="label">Rating</span>
                                    <span class="value">4.8/5</span>
                                </div>
                            </div>
                        </div>
                        
                        <button class="book-service-btn" onclick="bookService('${service.name}', ${basePrice}, ${index})">
                            <i class="fas fa-calendar-check"></i> Book Service Now
                        </button>
                    </div>
                `;
                
                container.appendChild(serviceCard);
            });
        }

        // Toggle inclusions
        function toggleInclusions(index) {
            const moreDiv = document.getElementById(`more-${index}`);
            const button = event.target;
            
            if (moreDiv.classList.contains('hidden')) {
                moreDiv.classList.remove('hidden');
                button.innerHTML = '<i class="fas fa-chevron-up"></i> Show Less';
            } else {
                moreDiv.classList.add('hidden');
                button.innerHTML = '<i class="fas fa-chevron-down"></i> Show More';
            }
        }

        // Book service
        function bookService(serviceName, basePrice, serviceIndex) {
            // Calculate final price including any applied coupon
            let finalPrice = basePrice;
            if (appliedCoupon && appliedCoupon.serviceIndex === serviceIndex) {
                finalPrice = basePrice - couponDiscount;
            }
            
            selectedService = {
                name: serviceName,
                basePrice: basePrice,
                finalPrice: finalPrice,
                couponApplied: appliedCoupon ? appliedCoupon.code : null,
                discountAmount: couponDiscount
            };

            // Check if mobile number is available
            if (!userMobile) {
                showMobileModal();
            } else {
                proceedWithBooking();
            }
        }

        // Show mobile number modal
        function showMobileModal() {
            const modal = document.getElementById('mobileModal');
            modal.classList.add('show');
            document.getElementById('mobileNumber').focus();
        }

        // Close mobile modal
        function closeMobileModal() {
            const modal = document.getElementById('mobileModal');
            modal.classList.remove('show');
        }

        // Handle mobile form submission
        document.getElementById('mobileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const mobileInput = document.getElementById('mobileNumber');
            const mobile = mobileInput.value.trim();
            const errorDiv = document.getElementById('mobileError');
            const submitBtn = document.getElementById('submitMobile');
            
            // Clear previous errors
            errorDiv.textContent = '';
            mobileInput.classList.remove('error');
            
            // Validate mobile number
            if (!mobile) {
                errorDiv.textContent = 'Please enter your mobile number';
                mobileInput.classList.add('error');
                return;
            }
            
            if (!isValidMobile(mobile)) {
                errorDiv.textContent = 'Please enter a valid 10-digit mobile number';
                mobileInput.classList.add('error');
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="btn-loading"><div class="spinner"></div>Processing...</div>';
            
            // Set mobile and proceed
            userMobile = mobile;
            mixpanel.identify(mobile);
            mixpanel.people.set({
                "$phone": mobile,
                "Last Updated": new Date()
            });
            
            setTimeout(() => {
                closeMobileModal();
                proceedWithBooking();
                
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span class="btn-text">Continue Booking</span>';
            }, 1000);
        });

        // Proceed with booking
        async function proceedWithBooking() {
            const brand = localStorage.getItem("brand");
            const carName = localStorage.getItem("carName");
            
            try {
                // Show loading state
                document.getElementById('loadingState').classList.remove('hidden');
                updateSectionTitle('Processing Your Booking...', 'Please wait while we confirm your service booking');
                
                // Prepare booking message
                let bookingMessage = `Service Booking: ${selectedService.name} for ${brand} ${carName}`;
                if (selectedService.couponApplied) {
                    bookingMessage += ` - Original Price: ${selectedService.basePrice} - Coupon Applied: ${selectedService.couponApplied} (${selectedService.discountAmount} discount) - Final Price: ${selectedService.finalPrice}`;
                } else {
                    bookingMessage += ` - Price: ${selectedService.finalPrice}`;
                }
                
                // Call the booking API
                const bookingResponse = await fetch('https://ai.instantmechanic.online/bot/service-query/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        mobile: userMobile,
                        message: bookingMessage
                    })
                });
                
                const bookingData = await bookingResponse.json();
                
                // Track booking confirmation
                const trackingData = {
                    'Service': selectedService.name,
                    'Brand': brand,
                    'Car Model': carName,
                    'Base Price': selectedService.basePrice,
                    'Final Price': selectedService.finalPrice,
                    'Mobile': userMobile,
                    'Booking Status': 'Confirmed',
                    'Timestamp': new Date().toISOString()
                };
                
                if (selectedService.couponApplied) {
                    trackingData['Coupon Used'] = selectedService.couponApplied;
                    trackingData['Discount Amount'] = selectedService.discountAmount;
                    trackingData['Coupon Savings'] = selectedService.discountAmount;
                }
                
                mixpanel.track('Service Booking Confirmed', trackingData);
                
                // Track Facebook Pixel event
                if (typeof fbq !== 'undefined') {
                    fbq('track', 'Purchase', {
                        content_name: selectedService.name,
                        content_category: 'Car Service',
                        value: selectedService.finalPrice,
                        currency: 'INR'
                    });
                }
                
                // Hide loading and show success page
                document.getElementById('loadingState').classList.add('hidden');
                showSuccessPage();
                
            } catch (error) {
                document.getElementById('loadingState').classList.add('hidden');
                
                // Track error
                mixpanel.track('Service Booking Error', {
                    'Service': selectedService.name,
                    'Brand': brand,
                    'Car Model': carName,
                    'Mobile': userMobile,
                    'Error': error.message,
                    'Timestamp': new Date().toISOString()
                });
                
                alert('Booking failed. Please try again or contact us directly.');
            }
        }

        // Show success page
        function showSuccessPage() {
            const brand = localStorage.getItem("brand");
            const carName = localStorage.getItem("carName");
            
            // Populate booking details
            const detailsContainer = document.getElementById('bookingDetails');
            let detailsHTML = `
                <div class="detail-row">
                    <span class="detail-label">Service:</span>
                    <span class="detail-value">${selectedService.name}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Vehicle:</span>
                    <span class="detail-value">${brand} ${carName}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Mobile:</span>
                    <span class="detail-value">+91 ${userMobile}</span>
                </div>`;
            
            if (selectedService.couponApplied) {
                detailsHTML += `
                <div class="detail-row">
                    <span class="detail-label">Base Price:</span>
                    <span class="detail-value">${selectedService.basePrice}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Coupon Applied:</span>
                    <span class="detail-value">${selectedService.couponApplied} (-${selectedService.discountAmount})</span>
                </div>`;
            }
            
            detailsHTML += `
                <div class="detail-row">
                    <span class="detail-label">Final Price:</span>
                    <span class="detail-value">${selectedService.finalPrice}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Booking ID:</span>
                    <span class="detail-value">#IM${Date.now().toString().slice(-6)}</span>
                </div>`;
            
            detailsContainer.innerHTML = detailsHTML;
            
            // Update WhatsApp link
            let message = `Hi Instant Mechanic team! \n\nMy service booking details:\n Service: ${selectedService.name}\n Vehicle: ${brand} ${carName}`;
            
            if (selectedService.couponApplied) {
                message += `\n Base Price: ${selectedService.basePrice}\n Coupon: ${selectedService.couponApplied} (${selectedService.discountAmount} off)\n Final Price: ${selectedService.finalPrice}`;
            } else {
                message += `\n Price: ${selectedService.finalPrice}`;
            }
            
            message += `\n Mobile: ${userMobile}\n\nPlease confirm my appointment. Thank you!`;
            
            const whatsappLink = document.getElementById('whatsappLink');
            whatsappLink.href = `https://wa.me/919266961110?text=${encodeURIComponent(message)}`;
            
            // Show success page with animation
            document.getElementById('successPage').classList.add('show');
        }

        // Update progress
        function updateProgress(step) {
            currentStep = step;
            
            // Update steps
            for (let i = 1; i <= 4; i++) {
                const stepElement = document.getElementById(`step${i}`);
                stepElement.classList.remove('active', 'completed');
                
                if (i < step) {
                    stepElement.classList.add('completed');
                    stepElement.innerHTML = '<i class="fas fa-check"></i>';
                } else if (i === step) {
                    stepElement.classList.add('active');
                    stepElement.innerHTML = i;
                } else {
                    stepElement.innerHTML = i;
                }
            }
            
            // Update progress line
            const progressLine = document.getElementById('progressLine');
            const width = ((step - 1) / 3) * 100;
            progressLine.style.width = `${width}%`;
        }

        // Update section title
        function updateSectionTitle(title, subtitle) {
            document.getElementById('sectionTitle').innerHTML = `
                <h1 class="fade-in">${title}</h1>
                <p class="fade-in">${subtitle}</p>
            `;
        }

        // Mobile number input formatting
        document.getElementById('mobileNumber').addEventListener('input', function(e) {
            // Only allow numbers
            this.value = this.value.replace(/[^0-9]/g, '');
            
            // Clear error state when user starts typing
            if (this.value.length > 0) {
                this.classList.remove('error');
                document.getElementById('mobileError').textContent = '';
            }
        });

        // Handle mobile number paste
        document.getElementById('mobileNumber').addEventListener('paste', function(e) {
            setTimeout(() => {
                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
            }, 10);
        });

        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMobileModal();
            }
        });

        // Close modal on overlay click
        document.getElementById('mobileModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMobileModal();
            }
        });

        // Prevent page refresh when mobile already provided
        window.addEventListener('beforeunload', function(e) {
            if (currentStep > 1) {
                e.preventDefault();
                e.returnValue = 'Are you sure you want to leave? Your progress will be lost.';
            }
        });

        // Generate direct service URL for agents
        function generateDirectServiceURL(brandId, brandName, carId, carName, carImage, mobile) {
            const baseURL = window.location.origin + window.location.pathname;
            const params = new URLSearchParams();
            
            if (mobile) params.set('mobile', mobile);
            if (brandId) params.set('brand_id', brandId);
            if (brandName) params.set('brand_name', brandName);
            if (carId) params.set('car_id', carId);
            if (carName) params.set('car_name', carName);
            if (carImage) params.set('car_image', carImage);
            
            return `${baseURL}?${params.toString()}`;
        }

        // Example usage for agents:
        // Direct to brand selection: ?mobile=9876543210&brand_id=1&brand_name=Maruti
        // Direct to pricing page: ?mobile=9876543210&brand_id=1&brand_name=Maruti&car_id=123&car_name=Swift&car_image=image_url
        

    </script>
</body>
</html>
