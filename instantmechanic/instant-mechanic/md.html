from rest_framework.decorators import api_view
from rest_framework.response import Response
from datetime import datetime
from django.db.models import Sum
from bot.models import Mechanic, Booking

@api_view(['GET'])
def mechanic_details(request):
    try:
        mobile = request.GET.get('mobile')
        if not mobile:
            return Response({"error": "Mobile parameter is required."}, status=400)

        mechanic = Mechanic.objects.filter(mobile=mobile, is_deleted=False).first()
        if not mechanic:
            return Response({"error": "Mechanic not found."}, status=404)

        # Calculate total earnings and bookings (optional logic)
        total_bookings = Booking.objects.filter(mechanic__mobile=mobile).count()


        data = {
            "name": mechanic.name,
            "mobile": mechanic.mobile,
            "rating": "4.9",
            "location": mechanic.location,
            "city": mechanic.city,
            "total_bookings": int(total_bookings)*5,
        }

        return Response(data, status=200)

    except Exception as e:
        return Response({"error": str(e)}, status=500)
